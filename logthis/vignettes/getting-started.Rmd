---
title: "Getting Started with logthis"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting Started with logthis}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(logthis)
```

# Introduction

The `logthis` package provides a structured logging framework for R applications. This vignette will walk you through the basics of setting up and using loggers in your R projects.

## Creating Your First Logger

The simplest way to get started is to create a logger with console output:

```{r basic-logger}
# Create a basic logger
log_this <- logger() %>%
    with_receivers(to_console()) %>%
    with_limits(lower = NOTE, upper = HIGHEST)

# Test it out
log_this(NOTE("Hello, logging world!"))
log_this(WARNING("This is a warning"))
log_this(ERROR("This is an error"))
```

## Understanding Event Levels

`logthis` uses a hierarchical system with numeric levels from 0 to 100:

- **LOWEST (0)** - Lowest priority debugging
- **TRACE (10)** - Trace-level debugging
- **DEBUG (20)** - Verbose debugging output
- **NOTE (30)** - General notes and information
- **MESSAGE (40)** - Important messages
- **WARNING (60)** - Warning conditions
- **ERROR (80)** - Error conditions
- **CRITICAL (90)** - Critical events
- **HIGHEST (100)** - Highest priority

```{r event-levels}
# Create events at different levels
log_this(DEBUG("This is very detailed debug info"))
log_this(NOTE("Application started successfully"))
log_this(MESSAGE("Processing 1000 records"))
log_this(WARNING("Found 5 missing values"))
log_this(ERROR("Database connection failed"))
```

## Filtering with Limits

`logthis` provides a sophisticated two-level filtering system:

### Logger-Level Filtering (First Filter)

Set limits on the entire logger - events outside these bounds never reach any receivers:

```{r logger-filtering}
# Only WARNING and ERROR events are processed at all
log_this <- logger() %>%
    with_receivers(to_console()) %>%
    with_limits(lower = WARNING, upper = HIGHEST)

log_this(NOTE("This won't be processed"))      # Blocked by logger
log_this(WARNING("This will be processed"))    # Passes logger filter
```

### Receiver-Level Filtering (Second Filter)  

Each receiver can further filter events that passed the logger filter:

```{r receiver-filtering}
# Logger allows NOTE+, but console receiver only shows WARNING+
log_this <- logger() %>%
    with_receivers(to_console(lower = WARNING)) %>%
    with_limits(lower = NOTE, upper = HIGHEST)

log_this(DEBUG("Blocked by logger"))      # Below logger limit
log_this(NOTE("Blocked by receiver"))       # Passes logger, blocked by receiver
log_this(WARNING("Reaches console"))        # Passes both filters
```

### Combined Filtering Strategy

```{r combined-filtering}
# Sophisticated filtering with multiple receivers
log_this <- logger() %>%
    with_receivers(
        to_console(lower = WARNING),     # Console: warnings and errors only
        to_identity()                        # Audit: all events that pass logger  
    ) %>%
    with_limits(lower = NOTE, upper = HIGHEST)  # Logger: notes and above

# Events flow: DEBUG blocked by logger
#              NOTE reaches audit receiver only
#              WARNING+ reaches both receivers
```

## Multiple Receivers

A powerful feature of `logthis` is the ability to send log events to multiple destinations:

```{r multiple-receivers}
```{r multiple-receivers}
# Send to console and capture for testing
log_this <- logger() %>%
    with_receivers(
        to_console(),
        to_identity()  # Returns the event for inspection
    )

result <- log_this(WARNING("Sent to multiple receivers"))
print(result)  # The returned event object
```
```

## Custom Event Levels

You can define your own event levels for specific use cases:

```{r custom-levels}
# Define custom levels
TRACE <- log_event_level("TRACE", 10)
DEBUG <- log_event_level("DEBUG", 30)
INFO <- log_event_level("INFO", 50)

# Use custom levels
log_this(TRACE("Entering function xyz()"))
log_this(DEBUG("Variable x = 42"))  
log_this(INFO("Processing completed"))
```

## Structured Logging

Log events can contain additional metadata:

```{r structured}
# Create events with custom fields
user_event <- WARNING("User login failed", 
                     user_id = "john_doe",
                     ip_address = "192.168.1.100",
                     attempt_count = 3)

log_this(user_event)
```

## Common Use Cases

`logthis` is designed for a variety of enterprise applications:

### GxP Validation & Pharmaceutical Compliance

For pharmaceutical and clinical research, logthis provides complete audit trails for data validation:

```{r gxp-example, eval=FALSE}
library(validate)

# Create GxP-compliant logger
log_gxp <- logger() %>%
  with_tags(
    study_id = "STUDY-001",
    system_name = "Clinical Data Validation",
    regulation = "21CFR11"
  ) %>%
  with_receivers(
    to_json() %>% on_local(path = "audit_trail.jsonl")
  )

# Define validation rules
rules <- validator(
  age_valid = age >= 18 & age <= 100,
  weight_positive = weight > 0
)

# Validate with audit trail
validate_with_audit(
  data = clinical_data,
  rules = rules,
  logger = log_gxp,
  user_id = "data_manager",
  reason = "Monthly data quality check"
)
```

See the **[GxP Validation vignette](gxp-validation.Rmd)** for comprehensive guidance on 21 CFR Part 11 compliance, electronic signatures, and ALCOA+ audit trails.

### Shiny Applications

Log user interactions and errors in Shiny apps:

```{r shiny-example, eval=FALSE}
library(logshiny)

server <- function(input, output, session) {
  log_this <- logger() %>%
    with_receivers(
      to_console(),
      logshiny::to_shinyalert(lower = ERROR)
    )

  observeEvent(input$submit, {
    log_this(NOTE("User submitted form"))
  })
}
```

### Data Analysis Pipelines

Track data processing steps:

```{r pipeline-example, eval=FALSE}
log_this <- logger() %>%
  with_receivers(
    to_console(),
    to_json() %>% on_local("pipeline.jsonl")
  )

log_this(NOTE("Starting data processing"))
log_this(MESSAGE(paste("Processed", nrow(data), "records")))
```

## Next Steps

This covers the basics of using `logthis`. For more advanced usage, see:

- **[GxP Validation & Compliance](gxp-validation.Rmd)** - Pharmaceutical data validation with audit trails
- **[Tagging and Provenance](tagging-and-provenance.Rmd)** - Track data lineage and context
- **[Advanced Receivers](advanced-receivers.Rmd)** - Cloud storage, webhooks, and custom outputs
- **[Patterns](patterns.Rmd)** - Common logging patterns and best practices